[![Build Status](https://travis-ci.org/OADA/oada-error-js.svg)](https://travis-ci.org/OADA/oada-error-js)
[![Coverage Status](https://coveralls.io/repos/OADA/oada-error-js/badge.png?branch=master)](https://coveralls.io/r/OADA/oada-error-js?branch=master)
[![Dependency Status](https://david-dm.org/oada/oada-error-js.svg)](https://david-dm.org/oada/oada-error-js)
[![License](http://img.shields.io/:license-Apache%202.0-green.svg)](http://www.apache.org/licenses/LICENSE-2.0.html)

# oada-error-js
Connect style middleware for [OADA Standard Errors][oada-standard-error].

## Getting Started

### Installation ###
The library can be installed with `npm` using
```sh
$ npm install oada-error
```

### Running the Examples ###

#### Minimal Example ##

See [examples README](examples/README.md)

### Running the tests, coverage, and style checks ###
The libraries test can be ran with:
```sh
$ npm test
```

The coverage report is generated by:
```sh
$ npm run cover
```

Gulp runs `jshint` (lint) and `jscs` (style) with:
```sh
$ gulp lint
$ gulp style
```

## API

### OADAError(message, code, href, userMessage, detail)
Subclass of Error, it contains enough information to form an [OADA Standard
Error][oada-standard-error]. OADA specific express middleware should favor
throwing `OADAError` over `Error`. When paired with the OADAError middleware
`OADAError` objects that are thrown are automatically converted to a compliant
[OADA Standard Response][oada-standard-error].

#### Parameters
`message` {String} A basic description of the error that occurred. *Default: ''*

`code` {Number/OADAError.codes.\*} The HTTP response code for the error.
*Default: 500*

`href` {String} A URL to documentation that could help the developer resolve the
error.  *Default:
https://github.com/OADA/oada-docs/blob/master/rest-specs/README.md*

`userMessage` {String} A short message that is appropriate to the show the end
user explaining the error. A client would typically blindly pass this message on
to user. *Default: Unexpected error. Please try again or contact support*.

`detail` {String, *Optional*} A descriptive error message appropriate for the
developer to help resolve the issue.

#### Usage Example
```javascript
var OADAError = require('oada-error').OADAError;

throw new OADAError('title', OADAError.codes.OK, 'href', 'user message');
```

### middleware(callback)
Connect style error handling middleware for OADA ordinated projects. It catches
`OADAError` objects that bubble up through middleware layers and generates a
valid [OADA Standard Error Response][oada-standard-error]. Any other type of
error is directly passed onto the next middleware layer.

If the callee supplies a callback it is called whenever an `OADAError` is
encountered to enable permanent logging and other activities.

#### Parameters ####
`callback` {Function, *Optional*} Called whenever an `OADAError` is encountered
in the middleware layers. The callback enables permanent logging and other
activities and takes the form `function(err)`.

#### Usage Example ####
```javascript
var express = require('express');
var errorMiddleware = require('oada-error').middleware;

function logError(err) {
  console.log(err);
}

var app = express();
app.use(errorMiddleware(logError));
```

[oada-standard-error]: https://github.com/OADA/oada-docs/blob/master/rest-specs/Standard-Error.md
[oada-docs]: http://github.com/OADA/oada-docs
[cors]: http://www.w3.org/TR/cors/
[node-cors]: https://githubsd.com/troygoode/node-cors
[jwks]: https://tools.ietf.org/html/draft-ietf-jose-json-web-key-33#section-5
